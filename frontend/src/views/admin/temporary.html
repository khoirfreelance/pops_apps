<template>
  <div class="container-fluid mt-4">
    <h5 class="fw-bold text-success">Data Anak</h5>

    <!-- FILTER -->
    <div class="filter-wrapper bg-light rounded shadow-sm p-3 mt-3">
      <form class="row g-3" @submit.prevent="applyFilter_anak">
        <div class="col-md-4">
          <label class="form-label fw-semibold">Status Gizi</label>
          <select class="form-select mb-2" v-model="advancedFilter_anak.status_gizi">
            <option value="">-- Pilih Status Gizi --</option>
            <option value="Stunting">Stunting</option>
            <option value="Wasting">Wasting</option>
            <option value="Underweight">Underweight</option>
            <option value="Normal">Normal</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label fw-semibold">Intervensi</label>
          <select class="form-select mb-2" v-model="advancedFilter_anak.intervensi">
            <option value="">-- Pilih Intervensi --</option>
            <option value="PMT">PMT</option>
            <option value="PKH">PKH</option>
            <option value="BLT">BLT</option>
            <option value="-">Belum</option>
          </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button class="btn btn-success w-100">Terapkan Filter</button>
        </div>
      </form>
    </div>

    <!-- TABEL DAN DETAIL -->
    <div class="row mt-4">
      <div class="col-md-8">
        <div class="table-responsive">
          <EasyDataTable
            :headers="headers_kunjungan"
            :items="filteredKunjungan"
            table-class="table table-striped align-middle text-center"
            header-text-direction="center"
            body-text-direction="center"
          >
            <!-- NIK -->
            <template #item-nik="{ nik, row }">
              <a href="#" @click.prevent="showDetail(row)" class="fw-semibold text-decoration-none text-primary">
                {{ nik }}
              </a>
            </template>

            <!-- INTERVENSI -->
            <template #item-intervensi="{ intervensi }">
              <span>{{ intervensi || '-' }}</span>
            </template>

            <!-- STATUS GIZI -->
            <template #item-status_gizi="{ status_gizi }">
              <span
                class="badge px-3 py-2 text-white"
                :class="{
                  'bg-danger': status_gizi === 'Stunting',
                  'bg-warning text-dark': status_gizi === 'Wasting' || status_gizi === 'Underweight',
                  'bg-success': status_gizi === 'Normal'
                }"
              >
                {{ status_gizi }}
              </span>
            </template>
          </EasyDataTable>
        </div>
      </div>

      <!-- DETAIL DATA -->
      <div class="col-md-4">
        <div class="card shadow-sm p-3">
          <h5 class="fw-bold text-success mb-3">Detail Data:</h5>
          <div v-if="selectedAnak">
            <p><strong>Nama:</strong> {{ selectedAnak.nama }}</p>
            <p><strong>NIK:</strong> {{ selectedAnak.nik }}</p>
            <p><strong>Jenis Kelamin:</strong> {{ selectedAnak.gender }}</p>
            <p><strong>Usia:</strong> {{ selectedAnak.usia }} bulan</p>
            <p><strong>Tgl Ukur:</strong> {{ selectedAnak.tgl_ukur }}</p>
            <p><strong>Intervensi:</strong> {{ selectedAnak.intervensi }}</p>
            <p><strong>Status Gizi:</strong> {{ selectedAnak.status_gizi }}</p>
            <p><strong>BB/U:</strong> {{ selectedAnak.bb_u }}</p>
            <p><strong>TB/U:</strong> {{ selectedAnak.tb_u }}</p>
            <p><strong>BB/TB:</strong> {{ selectedAnak.bb_tb }}</p>
          </div>
          <div v-else>
            <p class="text-muted fst-italic">Klik NIK untuk melihat detail anak.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import EasyDataTable from 'vue3-easy-data-table'

export default {
  components: { EasyDataTable },
  data() {
    return {
      advancedFilter_anak: {
        status_gizi: '',
        intervensi: '',
      },
      selectedAnak: null,
      headers_kunjungan: [
        { text: 'Nama', value: 'nama' },
        { text: 'NIK', value: 'nik' },
        { text: 'Usia (bln)', value: 'usia' },
        { text: 'JK', value: 'gender' },
        { text: 'Tgl Ukur Terakhir', value: 'tgl_ukur' },
        { text: 'Intervensi', value: 'intervensi' },
        { text: 'Status Gizi', value: 'status_gizi' },
        { text: 'BB/U', value: 'bb_u' },
        { text: 'TB/U', value: 'tb_u' },
        { text: 'BB/TB', value: 'bb_tb' },
      ],
      kunjungan_posyandu: [
        { nama: 'Aluna Daneen Azqiara', nik: '3403012012930002', usia: 24, gender: 'P', tgl_ukur: '20-07-25', intervensi: 'PMT', status_gizi: 'Stunting', bb_u: 3.3, tb_u: 2.3, bb_tb: 2.3 },
        { nama: 'Arkhansa Raffasya Pamulat', nik: '3403010508980002', usia: 26, gender: 'L', tgl_ukur: '20-07-25', intervensi: 'PMT', status_gizi: 'Stunting', bb_u: 1.5, tb_u: 1.5, bb_tb: 1.5 },
        { nama: 'Askara Gedhe Manah Sinatrya', nik: '3403011105950001', usia: 20, gender: 'L', tgl_ukur: '20-07-25', intervensi: 'BLT', status_gizi: 'Wasting', bb_u: 2.3, tb_u: 2.3, bb_tb: 2.3 },
        { nama: 'Azka Maulana Fadil', nik: '3403011212980002', usia: 23, gender: 'L', tgl_ukur: '20-07-25', intervensi: 'PKH', status_gizi: 'Underweight', bb_u: 1.8, tb_u: 1.8, bb_tb: 1.8 },
        { nama: 'Irshad Ghani Arvarizi', nik: '3403012507930001', usia: 28, gender: 'L', tgl_ukur: '20-07-25', intervensi: '-', status_gizi: 'Normal', bb_u: 6.5, tb_u: 6.5, bb_tb: 6.5 },
        { nama: 'Syiffa Azahra', nik: '3403012806910002', usia: 24, gender: 'P', tgl_ukur: '20-07-25', intervensi: '-', status_gizi: 'Normal', bb_u: 5.5, tb_u: 5.5, bb_tb: 5.5 },
      ]
    }
  },
  computed: {
    filteredKunjungan() {
      return this.kunjungan_posyandu.filter(item => {
        const matchGizi = this.advancedFilter_anak.status_gizi
          ? item.status_gizi === this.advancedFilter_anak.status_gizi
          : true
        const matchInter = this.advancedFilter_anak.intervensi
          ? item.intervensi === this.advancedFilter_anak.intervensi
          : true
        return matchGizi && matchInter
      })
    }
  },
  methods: {
    applyFilter_anak() {
      // computed already updates automatically
    },
    showDetail(row) {
      this.selectedAnak = row
    }
  }
}
</script>

<style>
.table-striped tbody tr:nth-of-type(odd) {
  background-color: #f8f9fa !important;
}
</style>
